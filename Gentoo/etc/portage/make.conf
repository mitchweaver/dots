#=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/
#
#     .vir.                                d$b
#  .d$$$$$$b.    .cd$$b.     .d$$b.   d$$$$$$$$$$$b  .d$$b.      .d$$b.
#  $$$$( )$$$b d$$$()$$$.   d$$$$$$$b Q$$$$$$$P$$$P.$$$$$$$b.  .$$$$$$$b.
#  Q$$$$$$$$$$B$$$$$$$$P"  d$$$PQ$$$$b.   $$$$.   .$$$P' `$$$ .$$$P' `$$$
#    "$$$$$$$P Q$$$$$$$b  d$$$P   Q$$$$b  $$$$b   $$$$b..d$$$ $$$$b..d$$$
#   d$$$$$$P"   "$$$$$$$$ Q$$$     Q$$$$  $$$$$   `Q$$$$$$$P  `Q$$$$$$$P
#  $$$$$$$P       `"""""   ""        ""   Q$$$P     "Q$$$P"     "Q$$$P"
#  `Q$$P"                                  """
#
# $ /etc/portage/make.conf
#
# https://github.com/mitchweaver/dots
#
#=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/=/

# ======================================================
# ENABLE GentooLTO
# see: https://github.com/InBetweenNames/gentooLTO
# ======================================================
NTHREADS=auto
source /etc/portage/make.conf.lto

# ======================================================
# PORTAGE SETTINGS
# ======================================================
EMERGE_DEFAULT_OPTS="--alphabetical --ask --ask-enter-invalid --verbose"
FEATURES="fail-clean parallel-fetch parallel-install network-sandbox ipc-sandbox userpriv userfetch compress-build-logs compressdebug nodoc noinfo -news -ccache"

# ==================================================
# IF USING CCACHE (not recommended)
# ==================================================
#CCACHE_DIR=/var/cache/ccache
#CCACHE_CONFIGPATH=/etc/portage/ccache.conf
#CCACHE_UMASK="0002"
# ==================================================

GRUB_PLATFORMS="efi-64"
ACCEPT_KEYWORDS="~amd64"
ACCEPT_LICENSE="-* @FREE @BINARY-REDISTRIBUTABLE GPL-2.0 GPL-3.0"
L10N="en"
LC_MESSAGES=C
PORTDIR=/var/db/repos/gentoo
DISTDIR=/var/cache/distfiles
PKGDIR=/var/cache/binpkgs

# run emerge at loweset priority so all other tasks won't get slowed down
# (system daemons, desktop use, etc)
PORTAGE_NICENESS=19
# set low priority scheduling
# see: https://wiki.gentoo.org/wiki/Portage_niceness#Scheduling_policy
PORTAGE_SCHEDULING_POLICY="idle"
# set ionice priority via a wrapper script
# see: https://wiki.gentoo.org/wiki/Portage_niceness#Configuration
PORTAGE_IONICE_COMMAND="/usr/local/bin/io-priority \${PID}"

# bug as of april 2023
# see: https://forums.gentoo.org/viewtopic-t-1162453-highlight-openssl+conflict.html
RUBY_TARGETS="ruby31"
PYTHON_TARGETS="python3_11 python3_10"

# ======================================================
# COMPILER FLAGS
# ======================================================
# make sure to also select hardened profile
source /etc/portage/make.conf.performance
source /etc/portage/make.conf.hardening

COMMON_FLAGS="$COMMON_FLAGS_PERFORMANCE $COMMON_FLAGS_HARDENING"
CFLAGS="${COMMON_FLAGS} $CFLAGS"
CPPFLAGS="${COMMON_FLAGS} $CPPFLAGS"
CXXFLAGS="${COMMON_FLAGS} $CXXFLAGS"
FCFLAGS="${COMMON_FLAGS} $FCFLAGS"
FFLAGS="${COMMON_FLAGS} $FFLAGS"

# use mold linker
# see /etc/portage/env/no-mold.conf for packages that break
LDFLAGS="-fuse-ld=mold -Wl,-O1 -Wl,--as-needed"

# ======================================================
# MACHINE SPECIFIC
# ======================================================
##########source /etc/portage/make.conf.thinkpad
source /etc/portage/make.conf.desktop
source /etc/portage/make.conf.intel

# ======================================================
# USE FLAGS
# ======================================================
USE="\
# ======================================================
# Positive Use Flags
# ======================================================
# GENTOO-LTO
lto pgo graphite \
# DESKTOP
X wayland bluetooth alsa pipewire screencast xinerama man \
# SECURITY
cet seccomp caps filecaps crypt \
# HARDENING
hardened \
# openrc/no-systemd
elogind udev dbus \
# MINIMAL / OPEN ALTERNATIVES
libedit openmp openipmi \
# GENTOO_SPECIFIC
branding \
# LAPTOP SPECIFIC
upower \
# ======================================================
# Negative Use Flags
# ======================================================
# SYSTEMD / CRAP WARE
-systemd -networkmanager -resolvconf -polkit -policykit -pulseaudio \
# EXTRA DOCS
-doc -gtk-doc -docs -handbook -examples -extras -test \
# KDE
-kde -kwallet -plasma -telepathy -semantic-desktop -webengine \
# GNOME
-gnome -gnome-keyring -introspection \
# ONLY ENABLE ON PER-PACKAGE BASIS
-libnotify -v4l -v4l2 \
-gif -png -jpeg -tiff -svg -pdf \
-mp3 -flac -vorbus -vpx -theora \
-truetype -xml -docx -ccache \
# STUFF I DONT CARE ABOUT
-nls -bindist -cjk -profile -lua -vala -sysprof -spell -colord \
# PRIVACY
-geoip -geoloc -telemetry -exif -gnome-online-accounts \
# OBSOLETE_HARDWARE
-dvd -dvdr -vcd -dv -cdda -cdinstall -cdr -bluray -a52 -css \
# OBSOLETE_LANGUAGE
-fortran -ada -ocaml -java -oracle -ibm -lisp \
# HARDWARE_DONT_CARE
-scanner -joystick -smartcard -wacom -input_devices_wacom \
# APPLE
-ipod -ios -ieee1394 -dc1394 -aqua -quicktime -xine -coreaudio -apple \
# PROTOCOLS
-kerberos -ldap -zeroconf -gstreamer -nntp -ipv6 \
# ACCESSIBILITY
-accessibility -sox -speex -speech \
# SHELLS I DONT USE
-bash-completion -zsh-completion -fish-completion \
# EMACS
-emacs -xemacs \
# DEBUG
-valgrind -unwind \
# JUNK
-startup-notification -appindicator -chromaprint -kvazaar -snappy \
# MISC
-cracklib -sendmail -lastfm -nas -oci8 -firebird -afs -emboss -oniguruma -calendar -berkdb \
"

################# PREFER GCC OVER CLANG
############## -clang -llvm \

